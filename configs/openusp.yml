# OpenUSP Platform Configuration
# This file contains all non-sensitive configuration parameters
# Credentials (usernames, passwords) remain in openusp.env for security

# =============================================================================
# SERVICE PORTS CONFIGURATION
# =============================================================================
ports:
  # HTTP/REST Service Ports
  http:
    api_gateway: 6500 # API Gateway HTTP + Swagger UI
    usp_service: 6250 # USP Service HTTP endpoints
    data_service: 6400 # Data Service HTTP for metrics

  # Health Check Ports
  health:
    api_gateway: 6501 # API Gateway health
    data_service: 6401 # Data Service health
    usp_service: 6251 # USP Service health
    cwmp_service: 7548 # CWMP Service health (Kafka-based, no HTTP endpoint)
    # MTP Transport-specific Health Endpoints
    mtp_stomp: 8087 # MTP STOMP health
    mtp_mqtt: 8089 # MTP MQTT health
    mtp_websocket: 8088 # MTP WebSocket health
    mtp_http: 8091 # MTP HTTP health

  # Metrics/Prometheus Ports
  metrics:
    api_gateway: 9100 # API Gateway metrics
    data_service: 9101 # Data Service metrics
    usp_service: 9102 # USP Service metrics
    cwmp_service: 9103 # CWMP Service metrics
    # MTP Transport-specific Metrics
    mtp_stomp: 9201 # MTP STOMP metrics
    mtp_mqtt: 9202 # MTP MQTT metrics
    mtp_websocket: 9203 # MTP WebSocket metrics
    mtp_http: 9205 # MTP HTTP metrics

# =============================================================================
# KAFKA MESSAGE BROKER CONFIGURATION
# =============================================================================
kafka:
  brokers:
    - "localhost:9092" # Kafka broker addresses (comma-separated for cluster)

  # Producer configuration
  producer:
    acks: "all" # Wait for all replicas to acknowledge
    compression: "snappy" # Compression type: none, gzip, snappy, lz4, zstd
    max_retries: 3
    retry_backoff_ms: 100
    batch_size: 16384
    linger_ms: 10
    buffer_memory: 33554432

  # Consumer configuration
  consumer:
    group_id_prefix: "openusp" # Will be suffixed with service name
    auto_offset_reset: "earliest" # earliest, latest, none
    enable_auto_commit: true
    auto_commit_interval_ms: 5000
    session_timeout_ms: 60000 # Increased to 60 seconds (from 30s)
    heartbeat_interval_ms: 10000 # Send heartbeat every 10 seconds
    max_poll_interval_ms: 300000 # 5 minutes - max time between poll() calls
    max_poll_records: 500
    fetch_min_bytes: 1
    fetch_max_wait_ms: 500

  # Topic configuration
  topics:
    # USP Message Flow (MTP <-> USP Service)
    usp_messages_inbound: "usp.messages.inbound" # From MTP services to USP service
    usp_messages_outbound: "usp.messages.outbound" # From USP service to MTP services
    usp_records_parsed: "usp.records.parsed" # Parsed USP records for analytics

    # USP Service <-> Data Service Communication
    usp_data_request: "usp.data.request" # USP requests data operations
    usp_data_response: "usp.data.response" # Data service responses to USP

    # USP Service <-> API Gateway Communication
    usp_api_request: "usp.api.request" # API Gateway requests to USP
    usp_api_response: "usp.api.response" # USP responses to API Gateway

    # Data Events (async event-driven)
    data_device_created: "data.device.created"
    data_device_updated: "data.device.updated"
    data_device_deleted: "data.device.deleted"
    data_parameter_updated: "data.parameter.updated"
    data_object_created: "data.object.created"
    data_alert_created: "data.alert.created"

    # CWMP Events
    cwmp_messages_inbound: "cwmp.messages.inbound" # From MTP-HTTP to CWMP service
    cwmp_messages_outbound: "cwmp.messages.outbound" # From CWMP service to MTP-HTTP

    # CWMP Service <-> Data Service Communication
    cwmp_data_request: "cwmp.data.request" # CWMP requests data operations
    cwmp_data_response: "cwmp.data.response" # Data service responses to CWMP

    # CWMP Service <-> API Gateway Communication
    cwmp_api_request: "cwmp.api.request" # API Gateway requests to CWMP
    cwmp_api_response: "cwmp.api.response" # CWMP responses to API Gateway

    # Agent Events
    agent_status_updated: "agent.status.updated"
    agent_onboarding_started: "agent.onboarding.started"
    agent_onboarding_completed: "agent.onboarding.completed"

    # MTP Transport Events (connection lifecycle)
    mtp_connection_established: "mtp.connection.established"
    mtp_connection_closed: "mtp.connection.closed"
    mtp_stomp_events: "mtp.stomp.events" # STOMP-specific events
    mtp_mqtt_events: "mtp.mqtt.events" # MQTT-specific events
    mtp_websocket_events: "mtp.websocket.events" # WebSocket-specific events

    # API Gateway Request/Response (for synchronous API calls)
    api_request: "api.request"
    api_response: "api.response"

  # Admin/Management
  admin:
    timeout_ms: 5000
    num_partitions: 3 # Default partitions for new topics
    replication_factor: 1 # Replication factor (use 3 for production cluster)

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
database:
  host: localhost
  port: 5433
  name: openusp_db
  user: openusp
  password: openusp123
  sslmode: disable

# =============================================================================
# REDIS CACHE CONFIGURATION
# =============================================================================
redis:
  host: localhost
  port: 6379
  password: openusp123
  db: 0

# =============================================================================
# INFRASTRUCTURE SERVICES
# =============================================================================
infrastructure:
  # Kafka Message Broker
  kafka:
    host: localhost
    port: 9092
    # Kafka UI (optional monitoring)
    ui_port: 8082

  # PostgreSQL (exposed from Docker)
  postgres:
    host: localhost
    port: 5433
    database: openusp_db

  # RabbitMQ (STOMP/AMQP)
  rabbitmq:
    host: localhost
    port: 5672
    mgmt_port: 15672
    stomp_port: 61613

  # Mosquitto (MQTT)
  mosquitto:
    host: localhost
    port: 1883
    websocket_port: 9001

  # Monitoring
  prometheus:
    port: 9090

  grafana:
    port: 3000

  # Adminer
  adminer:
    port: 8080

# =============================================================================
# SERVICE URLS (HTTP/REST only - inter-service via Kafka)
# =============================================================================
services:
  api_gateway:
    url: "http://localhost:6500" # HTTP API Gateway
  data_service:
    url: "http://localhost:6400" # Data Service HTTP (metrics/health)
  cwmp_service:
    url: "http://localhost:7548" # CWMP service health endpoint (Kafka-based, TR-069 on mtp-http:7547)
  usp_service:
    url: "http://localhost:6250" # USP service HTTP

# =============================================================================
# PROTOCOL CLIENT CONFIGURATION
# =============================================================================
protocols:
  usp:
    websocket_url: "ws://localhost:8081/ws"
  cwmp:
    acs_url: "http://localhost:7547"

# =============================================================================
# DEVELOPMENT/DEBUG CONFIGURATION
# =============================================================================
development:
  log_level: info
  log_dir: logs
  enable_debug: false
  enable_metrics: true

# =============================================================================
# DOCKER NETWORK CONFIGURATION
# =============================================================================
docker:
  network: openusp-dev

# =============================================================================
# MTP (MESSAGE TRANSPORT PROTOCOL) CONFIGURATION
# =============================================================================
mtp:
  # Transport enablement flags
  transports:
    websocket_enabled: true
    mqtt_enabled: true
    stomp_enabled: true

  # Transport-specific configuration
  websocket:
    server_port: 8081 # WebSocket server port for client connections
    subprotocol: v1.usp

  mqtt:
    broker_url: "tcp://localhost:1883"

  stomp:
    broker_url: "tcp://localhost:61613"
    # STOMP credentials (use environment variables for production)
    username: "openusp"
    password: "openusp123"
    # STOMP destination/queue configuration
    destinations:
      inbound: "/queue/agent->controller" # messages from agents (inbound to controller)
      outbound: "/queue/controller->agent" # messages to agents (outbound from controller)

  http:
    server_url: "http://localhost:7547" # HTTP/HTTPS server endpoint for TR-069/CWMP communication (standard port 7547)
    timeout: "60s"
    max_idle_connections: 10
    idle_timeout: "90s"
    tls_enabled: false
    # Authentication (optional, for secure endpoints)
    username: "openusp"
    password: "openusp123"

# =============================================================================
# USP PROTOCOL CONFIGURATION
# =============================================================================
usp:
  version_support: "1.3,1.4"
  endpoint_id: "proto::openusp.controller"
  default_timeout: 30

# =============================================================================
# USP SERVICE CONFIGURATION
# =============================================================================
usp_service:
  kafka:
    consumer_group: "usp-service" # Kafka consumer group for USP service
  timeouts:
    shutdown: "30s"
  http:
    read_timeout: "30s"
    write_timeout: "30s"
    idle_timeout: "120s"

# =============================================================================
# TR-181 DATA MODEL CONFIGURATION
# =============================================================================
tr181:
  schema_path: "pkg/datamodel/tr-181-2-19-1-usp-full.xml"
  types_path: "pkg/datamodel/tr-106-types.xml"
  validation_enabled: false

# =============================================================================
# CWMP SERVICE CONFIGURATION
# =============================================================================
cwmp_service:
  authentication:
    enabled: true
    username: "acs"
    password: "acs123"
  timeouts:
    connection: "30s"
    session: "300s"
    shutdown: "30s"
  sessions:
    max_concurrent: 100
  kafka:
    consumer_group: "cwmp-service-group" # Kafka consumer group for CWMP service

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================
security:
  api:
    cors_enabled: true
    cors_origins: "*"
  cwmp:
    basic_auth_enabled: true
